<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Classroom Clone</title>

  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
</head>
<body>
  <div id="app" class="container py-4">
    <div class="text-center" v-if="!user">
      <button class="btn btn-primary btn-lg" @click="signInWithGoogle">üîë ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏î‡πâ‡∏ß‡∏¢ Google</button>
    </div>

    <div v-else>
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>üìö ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
        <button class="btn btn-danger" @click="signOut">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>

      <div class="text-center mb-3">
        <button class="btn btn-info" @click="showProfile = !showProfile">üë§ ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
      </div>

      <!-- ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
      <div v-if="showProfile" class="card mx-auto p-3 mb-4" style="max-width: 400px;">
        <h5 class="text-center">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h5>
        <div class="text-center">
          <img :src="userPhoto" class="rounded-circle mb-3" width="100" height="100" v-if="userPhoto"/>
        </div>
        <label><b>‡∏ä‡∏∑‡πà‡∏≠:</b></label>
        <input type="text" v-model="userName" class="form-control mb-2"/>
        
        <label><b>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b></label>
        <p class="form-control bg-light">{{ user.email }}</p>

        <label><b>URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</b></label>
        <input type="text" v-model="userPhoto" class="form-control mb-3"/>

        <button class="btn btn-success w-100" @click="updateProfile">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      </div>

      <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
      <div class="text-center mb-3">
        <button class="btn btn-primary btn-lg" @click="showCreateForm = !showCreateForm">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
      </div>

      <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
      <div v-if="showCreateForm" class="card mx-auto p-3 mb-4" style="max-width: 500px;">
        <h5 class="text-center">üìå ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5>
        <input type="text" class="form-control mb-2" v-model="classCode" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" />
        <input type="text" class="form-control mb-2" v-model="className" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤" />
        <input type="text" class="form-control mb-3" v-model="classPhoto" placeholder="URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" />
        <button class="btn btn-success w-100" @click="createClassroom">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á</button>
      </div>

      <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
      <div class="row">
        <div v-for="classroom in classrooms" :key="classroom.id" class="col-md-4 mb-4">
          <div class="card shadow-sm">
            <img :src="classroom.info.photo || 'https://via.placeholder.com/400'" class="card-img-top" height="150"/>
            <div class="card-body">
              <h5 class="card-title text-center">{{ classroom.info.name }}</h5>
              <p class="card-text text-center">‡∏£‡∏´‡∏±‡∏™: {{ classroom.info.code }}</p>
              <div class="text-center">
                <button class="btn btn-danger btn-sm" @click="deleteClassroom(classroom.id)">üóëÔ∏è ‡∏•‡∏ö</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const { createApp, ref, onMounted } = Vue;

    const firebaseConfig = {
      apiKey: "AIzaSyAsEANU9p5dXhUIgITl-k5W3Wzh4K-7wfM",
      authDomain: "finalmobileweb.firebaseapp.com",
      projectId: "finalmobileweb",
      storageBucket: "finalmobileweb.appspot.com",
      messagingSenderId: "763318502667",
      appId: "1:763318502667:web:8aa0a7f919c3df79be0e0e",
      measurementId: "G-LSNZG1BMNT"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const firestore = firebase.firestore();

    createApp({
      setup() {
        const user = ref(null);
        const userName = ref("");
        const userPhoto = ref("");
        const classrooms = ref([]);
        const showCreateForm = ref(false);
        const showProfile = ref(false);
        
        const classCode = ref("");
        const className = ref("");
        const classPhoto = ref("");

        async function fetchClassrooms() {
          if (!user.value) return;
          const querySnapshot = await firestore.collection("users").doc(user.value.uid).collection("classroom").get();
          classrooms.value = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function deleteClassroom(classroomId) {
          if (!user.value) return;
          await firestore.collection("users").doc(user.value.uid).collection("classroom").doc(classroomId).delete();
          fetchClassrooms();
        }

        async function createClassroom() {
          if (!user.value) return;
          const classRef = firestore.collection("users").doc(user.value.uid).collection("classroom").doc();
          await classRef.set({
            owner: user.value.uid,
            info: {
              code: classCode.value,
              name: className.value,
              photo: classPhoto.value
            }
          });
          showCreateForm.value = false;
          fetchClassrooms();
        }

        async function signInWithGoogle() {
          const provider = new firebase.auth.GoogleAuthProvider();
          auth.signInWithPopup(provider).then((result) => {
            user.value = result.user;
            userName.value = result.user.displayName;
            userPhoto.value = result.user.photoURL;
            fetchClassrooms();
          }).catch((error) => {
            console.error("Google Sign-in Error:", error);
          });
        }

        async function signOut() {
          await auth.signOut();
          user.value = null;
          classrooms.value = [];
        }

        async function updateProfile() {
          if (!user.value) return;

          try {
            await user.value.updateProfile({
              displayName: userName.value,
              photoURL: userPhoto.value
            });

            user.value.displayName = userName.value;
            user.value.photoURL = userPhoto.value;

            alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
          } catch (error) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‚ùå");
          }
        }

        onMounted(() => {
          auth.onAuthStateChanged(async (loggedUser) => {
            user.value = loggedUser;
            if (loggedUser) {
              userName.value = loggedUser.displayName || "";
              userPhoto.value = loggedUser.photoURL || "";
              await fetchClassrooms();
            }
          });
        });

        return { user, userName, userPhoto, classrooms, showCreateForm, showProfile, classCode, className, classPhoto, signInWithGoogle, signOut, createClassroom, deleteClassroom, updateProfile };
      }
    }).mount("#app");
    
  </script>
  
</body>
</html>